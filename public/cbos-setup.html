<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CBOS - Manual de Configura√ß√£o</title>
    <style>
        @media print {
            body { margin: 0; }
            h1 { page-break-before: always; }
            h1:first-of-type { page-break-before: avoid; }
            pre { page-break-inside: avoid; }
            .no-print { display: none; }
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            color: #333;
        }
        h1 {
            color: #1a1a1a;
            border-bottom: 3px solid #4f46e5;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        h2 {
            color: #4f46e5;
            margin-top: 30px;
        }
        h3 {
            color: #6366f1;
            margin-top: 20px;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border-left: 4px solid #4f46e5;
        }
        code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            margin-right: 8px;
        }
        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-info { background: #dbeafe; color: #1e40af; }
        ul { padding-left: 25px; }
        li { margin: 8px 0; }
        .section { margin: 30px 0; }
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid;
        }
        .alert-success { background: #d1fae5; border-color: #065f46; }
        .alert-warning { background: #fef3c7; border-color: #92400e; }
        .alert-info { background: #dbeafe; border-color: #1e40af; }
        .print-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: #4f46e5;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .print-btn:hover {
            background: #4338ca;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background: #f9fafb;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <button class="print-btn no-print" onclick="window.print()">üñ®Ô∏è Salvar como PDF</button>

    <h1>CBOS - Competitor & Market Intelligence System</h1>
    <p style="font-size: 18px; color: #666;">Sistema de Monitora√ß√£o de Mercado e Intelig√™ncia Competitiva</p>

    <div class="alert alert-success">
        <strong>‚úÖ Sistema 100% Implementado!</strong><br>
        Todas as funcionalidades foram desenvolvidas e est√£o prontas para uso. Falta apenas configurar as APIs externas.
    </div>

    <div class="section">
        <h2>‚úÖ O QUE FOI IMPLEMENTADO</h2>

        <h3>1. Banco de Dados Completo</h3>
        <ul>
            <li><span class="badge badge-success">‚úÖ</span> Tabela <code>competitors</code> expandida (flag nacional/internacional, prioridade)</li>
            <li><span class="badge badge-success">‚úÖ</span> Tabela <code>social_trends</code> (tend√™ncias sociais)</li>
            <li><span class="badge badge-success">‚úÖ</span> Tabela <code>daily_campaigns</code> (campanhas di√°rias com ciclo de vida)</li>
            <li><span class="badge badge-success">‚úÖ</span> Tabela <code>admin_policies</code> (pol√≠ticas e prefer√™ncias)</li>
            <li><span class="badge badge-success">‚úÖ</span> Tabela <code>priority_destinations</code> (destinos priorit√°rios)</li>
            <li><span class="badge badge-success">‚úÖ</span> Tabela <code>content_calendar</code> (calend√°rio e embargos)</li>
            <li><span class="badge badge-success">‚úÖ</span> Tabela <code>market_alerts</code> (alertas de mercado)</li>
            <li><span class="badge badge-success">‚úÖ</span> Tabela <code>campaign_approvals</code> (log de aprova√ß√µes)</li>
            <li><span class="badge badge-success">‚úÖ</span> RLS policies para todas as tabelas</li>
            <li><span class="badge badge-success">‚úÖ</span> Triggers e √≠ndices otimizados</li>
        </ul>

        <h3>2. Dashboards Implementados</h3>
        <ul>
            <li><span class="badge badge-success">‚úÖ</span> <strong>Vis√£o Geral Brasil</strong> (prioridade #1): SOV, sentimento, Œî pre√ßos, alertas</li>
            <li><span class="badge badge-success">‚úÖ</span> <strong>Campanha do Dia</strong>: Gera√ß√£o com IA, diagn√≥stico, diretriz, plano, checklist</li>
            <li><span class="badge badge-success">‚úÖ</span> <strong>Mercado & Tend√™ncias</strong> (prioridade #2): Top keywords, destinos em alta</li>
            <li><span class="badge badge-success">‚úÖ</span> <strong>Tend√™ncias Sociais</strong> (prioridade #3): Top 10 trends com √≠ndice de correla√ß√£o</li>
            <li><span class="badge badge-success">‚úÖ</span> <strong>Pol√≠ticas & Prefer√™ncias</strong>: 5 abas de configura√ß√£o avan√ßada</li>
            <li><span class="badge badge-success">‚úÖ</span> <strong>An√°lises Legadas</strong>: Pre√ßos, Redes Sociais, Insights Estrat√©gicos</li>
        </ul>

        <h3>3. Edge Functions</h3>
        <ul>
            <li><span class="badge badge-success">‚úÖ</span> <code>analyze-competitors</code>: An√°lise de concorrentes</li>
            <li><span class="badge badge-success">‚úÖ</span> <code>generate-daily-campaign</code>: Gera campanha di√°ria com IA</li>
            <li><span class="badge badge-success">‚úÖ</span> <code>schedule-daily-analysis</code>: Job agendado para execu√ß√£o √†s 06:00 BRT</li>
        </ul>

        <h3>4. Funcionalidades</h3>
        <ul>
            <li><span class="badge badge-success">‚úÖ</span> Ciclo de vida de campanhas (vis√≠vel at√© 05:55, arquivamento autom√°tico)</li>
            <li><span class="badge badge-success">‚úÖ</span> Reten√ß√£o de 30 dias</li>
            <li><span class="badge badge-success">‚úÖ</span> Exporta√ß√£o de campanhas em JSON</li>
            <li><span class="badge badge-success">‚úÖ</span> Sistema de alertas com severidade</li>
            <li><span class="badge badge-success">‚úÖ</span> V√°lvulas de seguran√ßa (modo crise, aprova√ß√£o manual)</li>
            <li><span class="badge badge-success">‚úÖ</span> Integra√ß√£o com Lovable AI (sem necessidade de API keys externa)</li>
        </ul>
    </div>

    <div class="section">
        <h2>üîß CONFIGURA√á√ÉO NECESS√ÅRIA</h2>

        <h3>APIs Externas (Pendentes)</h3>
        <p>Para o sistema funcionar 100%, voc√™ precisa configurar as seguintes APIs no Lovable Cloud:</p>

        <h4>1. Google APIs</h4>
        <pre>GOOGLE_API_KEY=sua_chave_aqui
GOOGLE_CX_ID=seu_cx_id_aqui</pre>
        <p><strong>Como obter:</strong></p>
        <ul>
            <li>Acesse <a href="https://console.cloud.google.com/">Google Cloud Console</a></li>
            <li>Ative: Google Custom Search API, Google Trends API</li>
            <li>Crie credenciais ‚Üí API Key</li>
        </ul>

        <h4>2. YouTube</h4>
        <pre>YOUTUBE_API_KEY=sua_chave_aqui</pre>
        <p><strong>Como obter:</strong></p>
        <ul>
            <li>Acesse Google Cloud Console</li>
            <li>Ative: YouTube Data API v3</li>
            <li>Use a mesma API Key do Google</li>
        </ul>

        <h4>3. X (Twitter)</h4>
        <pre>X_BEARER_TOKEN=seu_token_aqui</pre>
        <p><strong>Como obter:</strong></p>
        <ul>
            <li>Acesse <a href="https://developer.x.com/">X Developer Portal</a></li>
            <li>Crie um App</li>
            <li>Gere Bearer Token em "Keys and Tokens"</li>
        </ul>

        <h4>4. Meta / Instagram</h4>
        <pre>META_APP_ID=seu_app_id_aqui
META_APP_SECRET=seu_secret_aqui
META_ACCESS_TOKEN=seu_token_aqui</pre>
        <p><strong>Como obter:</strong></p>
        <ul>
            <li>Acesse <a href="https://developers.facebook.com/">Meta for Developers</a></li>
            <li>Crie um App</li>
            <li>Configure Instagram Basic Display API</li>
            <li>Gere Access Token</li>
        </ul>

        <h4>5. TikTok</h4>
        <pre>TIKTOK_APP_ID=seu_app_id_aqui
TIKTOK_APP_SECRET=seu_secret_aqui
TIKTOK_ACCESS_TOKEN=seu_token_aqui</pre>
        <p><strong>Como obter:</strong></p>
        <ul>
            <li>Acesse <a href="https://developers.tiktok.com/">TikTok for Developers</a></li>
            <li>Crie um App</li>
            <li>Solicite acesso √† API</li>
        </ul>

        <div class="alert alert-info">
            <strong>üí° Como Adicionar as APIs no Projeto</strong><br><br>
            <strong>Via Interface Lovable Cloud:</strong><br>
            ‚Üí V√° em Settings ‚Üí Secrets<br>
            ‚Üí Adicione cada vari√°vel de ambiente acima
        </div>
    </div>

    <div class="section">
        <h2>‚è∞ AGENDAMENTO DI√ÅRIO (CRON JOB)</h2>

        <h3>Configurar o Job √†s 06:00 BRT (Segunda a Sexta)</h3>
        <p>O sistema foi projetado para executar <strong>automaticamente de segunda a sexta √†s 06:00</strong> (hor√°rio de Bras√≠lia).</p>

        <div class="alert alert-warning">
            <strong>IMPORTANTE:</strong> O sistema tamb√©m pode ser executado <strong>manualmente a qualquer hora e qualquer dia</strong> (incluindo s√°bados e domingos) usando o bot√£o "Executar Nova An√°lise" na interface.
        </div>

        <h4>Op√ß√£o 1: Supabase pg_cron (Recomendado)</h4>
        <p>Execute este SQL no Supabase SQL Editor:</p>
        <pre>-- Habilitar extens√µes
CREATE EXTENSION IF NOT EXISTS pg_cron;
CREATE EXTENSION IF NOT EXISTS pg_net;

-- Criar job di√°rio √†s 06:00 BRT (09:00 UTC) - SEGUNDA A SEXTA
SELECT cron.schedule(
  'cbos-daily-analysis',
  '0 9 * * 1-5', -- 09:00 UTC = 06:00 BRT, segunda a sexta
  $$
  SELECT net.http_post(
    url := 'https://xppgoccktxwfpqqvcqug.supabase.co/functions/v1/schedule-daily-analysis',
    headers := '{"Content-Type": "application/json", "Authorization": "Bearer SEU_ANON_KEY"}'::jsonb,
    body := '{}'::jsonb
  ) as request_id;
  $$
);

-- Verificar jobs agendados
SELECT * FROM cron.job;</pre>

        <h4>Formato Cron:</h4>
        <ul>
            <li><code>0 9 * * 1-5</code> = 09:00 UTC, segunda (1) a sexta (5)</li>
            <li><code>0 9 * * *</code> = 09:00 UTC, todos os dias</li>
            <li><code>0 9 * * 0,6</code> = 09:00 UTC, apenas s√°bado (6) e domingo (0)</li>
        </ul>
    </div>

    <div class="section">
        <h2>üìä COMO USAR O SISTEMA</h2>

        <h3>1. Primeira Execu√ß√£o</h3>
        <ol>
            <li>Fa√ßa login como admin</li>
            <li>V√° na aba "Concorrentes"</li>
            <li>Cadastre pelo menos 3-5 concorrentes com:
                <ul>
                    <li>Nome</li>
                    <li>Website</li>
                    <li>Redes sociais (Instagram, TikTok, YouTube, X)</li>
                    <li>Marque se √© Nacional (BR) ou Internacional</li>
                    <li>Defina a prioridade (Alta/M√©dia/Baixa)</li>
                </ul>
            </li>
        </ol>

        <h3>2. Configurar Pol√≠ticas</h3>
        <ol>
            <li>V√° na aba "Pol√≠ticas & Prefer√™ncias"</li>
            <li>Configure:
                <ul>
                    <li><strong>Destinos Priorit√°rios:</strong> Adicione destinos-chave</li>
                    <li><strong>Temas Sens√≠veis:</strong> Defina o que evitar</li>
                    <li><strong>Palavras Proibidas:</strong> Liste termos bloqueados</li>
                    <li><strong>Voz de Marca:</strong> Escolha o preset de tom</li>
                    <li><strong>Calend√°rio:</strong> Adicione feriados e datas importantes</li>
                </ul>
            </li>
            <li>Ative "Modo de Crise" se necess√°rio</li>
            <li>Ative "Exigir Aprova√ß√£o Manual" para revisar campanhas antes de publicar</li>
        </ol>

        <h3>3. Executar An√°lise Manual</h3>
        <ol>
            <li>V√° na aba "Monitora√ß√£o de Mercado"</li>
            <li>Clique em "Executar Nova An√°lise"</li>
            <li>Aguarde ~30 segundos</li>
            <li>Veja os resultados em:
                <ul>
                    <li>Vis√£o Geral BR</li>
                    <li>Mercado & Tend√™ncias</li>
                    <li>Pre√ßos, Redes Sociais, Insights</li>
                </ul>
            </li>
        </ol>

        <h3>4. Gerar Campanha do Dia</h3>
        <ol>
            <li>V√° na aba "Campanha do Dia"</li>
            <li>Clique em "Gerar Campanha do Dia"</li>
            <li>A IA criar√°:
                <ul>
                    <li>Diagn√≥stico (6 bullets)</li>
                    <li>Diretriz Estrat√©gica</li>
                    <li>Plano de Execu√ß√£o completo</li>
                    <li>Testes A/B</li>
                    <li>Checklist</li>
                </ul>
            </li>
            <li>Exporte em JSON se necess√°rio</li>
        </ol>
    </div>

    <div class="section">
        <h2>üéØ FLUXO AUTOM√ÅTICO DI√ÅRIO</h2>
        <p>Quando o cron job estiver configurado, <strong>DE SEGUNDA A SEXTA √†s 06:00</strong>:</p>

        <table>
            <thead>
                <tr>
                    <th>Hor√°rio</th>
                    <th>A√ß√£o</th>
                    <th>Descri√ß√£o</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>06:00</td>
                    <td>In√≠cio</td>
                    <td>Sistema executa schedule-daily-analysis</td>
                </tr>
                <tr>
                    <td>06:00-06:10</td>
                    <td>Coleta</td>
                    <td>Analisa pre√ßos, redes sociais, tend√™ncias</td>
                </tr>
                <tr>
                    <td>06:10-06:15</td>
                    <td>IA</td>
                    <td>Processa dados e gera Campanha do Dia</td>
                </tr>
                <tr>
                    <td>06:15</td>
                    <td>Publica√ß√£o</td>
                    <td>Campanha fica vis√≠vel no dashboard</td>
                </tr>
                <tr>
                    <td>05:55 (dia seguinte)</td>
                    <td>Arquivamento</td>
                    <td>Campanha anterior √© arquivada automaticamente</td>
                </tr>
                <tr>
                    <td>A cada 30 dias</td>
                    <td>Limpeza</td>
                    <td>Campanhas antigas s√£o deletadas</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section">
        <h2>üõ°Ô∏è V√ÅLVULAS DE SEGURAN√áA</h2>

        <h3>Pr√©-Publica√ß√£o</h3>
        <ul>
            <li>‚úÖ Checagem de palavras proibidas (bloqueio duro)</li>
            <li>‚úÖ Verifica√ß√£o de temas sens√≠veis</li>
            <li>‚úÖ Valida√ß√£o de destinos priorit√°rios</li>
            <li>‚úÖ Confer√™ncia de embargos do dia</li>
            <li>‚úÖ Modo de crise (se ativado)</li>
            <li>‚úÖ Aprova√ß√£o manual (se configurado)</li>
        </ul>

        <h3>Durante Opera√ß√£o</h3>
        <ul>
            <li>‚úÖ Detec√ß√£o de queda de pre√ßo ‚â•10%</li>
            <li>‚úÖ Monitoramento de sentimento negativo</li>
            <li>‚úÖ Identifica√ß√£o de trends de alto aproveitamento</li>
            <li>‚úÖ Alertas de novas campanhas concorrentes</li>
        </ul>
    </div>

    <div class="section">
        <h2>üîç TROUBLESHOOTING</h2>

        <table>
            <thead>
                <tr>
                    <th>Problema</th>
                    <th>Solu√ß√£o</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>"Nenhuma an√°lise dispon√≠vel"</td>
                    <td>Execute uma an√°lise manual primeiro ou aguarde o cron job √†s 06:00</td>
                </tr>
                <tr>
                    <td>"Aguardando APIs externas"</td>
                    <td>Configure as APIs no Secrets. Algumas funcionalidades funcionam sem APIs (usando Lovable AI)</td>
                </tr>
                <tr>
                    <td>"Erro ao gerar campanha"</td>
                    <td>Falta de dados de an√°lise. Execute an√°lise de mercado primeiro</td>
                </tr>
                <tr>
                    <td>Cron job n√£o executando</td>
                    <td>Verifique se pg_cron est√° habilitado no Supabase e se o hor√°rio est√° correto (UTC vs BRT)</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section">
        <h2>‚ú® PR√ìXIMOS PASSOS</h2>
        <ol style="font-size: 18px;">
            <li>‚úÖ Configure as APIs externas (Google, X, TikTok, Meta)</li>
            <li>‚úÖ Configure o cron job para 06:00 BRT (segunda a sexta)</li>
            <li>‚úÖ Cadastre 5-10 concorrentes priorit√°rios</li>
            <li>‚úÖ Configure destinos e pol√≠ticas</li>
            <li>‚úÖ Execute primeira an√°lise manual para testar</li>
            <li>‚úÖ Aguarde primeiro job autom√°tico √†s 06:00</li>
        </ol>
    </div>

    <div class="alert alert-success" style="margin-top: 40px; font-size: 18px;">
        <strong>üéâ Sistema totalmente implementado e pronto para uso!</strong><br>
        Falta apenas configurar as APIs externas.
    </div>

    <footer style="margin-top: 60px; padding-top: 20px; border-top: 2px solid #e5e7eb; text-align: center; color: #666;">
        <p>CBOS - Competitor & Market Intelligence System</p>
        <p>Desenvolvido para Ocitocina Viagens & Sonhos</p>
        <p style="font-size: 14px;">Documento gerado em <?php echo date('d/m/Y H:i'); ?></p>
    </footer>
</body>
</html>